<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Snake Game</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: #0a0a0a;
            color: #00ff88;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 2.5em;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .subtitle {
            font-size: 1em;
            color: #888;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-group {
            text-align: center;
        }

        .control-group h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            color: #00ff88;
        }

        .keys {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            width: 120px;
        }

        .key {
            background: #222;
            border: 1px solid #444;
            padding: 8px;
            font-size: 0.8em;
            text-align: center;
            border-radius: 3px;
        }

        .key.active {
            background: #00ff88;
            color: #000;
        }

        .game-container {
            position: relative;
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }

        #gameCanvas {
            background: #111;
            display: block;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
            padding: 0 20px;
        }

        .score {
            font-size: 1.2em;
            font-weight: 600;
        }

        .players {
            display: flex;
            gap: 30px;
        }

        .player {
            text-align: center;
        }

        .player-name {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .player-score {
            font-size: 1.1em;
            font-weight: 600;
        }

        .player1 { color: #00ff88; }
        .player2 { color: #ff4444; }
        .player3 { color: #4444ff; }
        .player4 { color: #ffff44; }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #00ff88;
            display: none;
        }

        .game-over h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #ff4444;
        }

        .game-over button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            font-family: 'JetBrains Mono', monospace;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .game-over button:hover {
            background: #00cc6a;
        }

        .instructions {
            margin-top: 20px;
            text-align: center;
            color: #888;
            font-size: 0.9em;
            max-width: 600px;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .game-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .players {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">Multiplayer Snake</h1>
        <p class="subtitle">Up to 4 players on one keyboard</p>
    </div>

    <div class="controls">
        <div class="control-group">
            <h3>Player 1 (Green)</h3>
            <div class="keys">
                <div class="key">Q</div>
                <div class="key">W</div>
                <div class="key">E</div>
                <div class="key">A</div>
                <div class="key">S</div>
                <div class="key">D</div>
            </div>
        </div>

        <div class="control-group">
            <h3>Player 2 (Red)</h3>
            <div class="keys">
                <div class="key">↑</div>
                <div class="key">↑</div>
                <div class="key">↑</div>
                <div class="key">←</div>
                <div class="key">↓</div>
                <div class="key">→</div>
            </div>
        </div>

        <div class="control-group">
            <h3>Player 3 (Blue)</h3>
            <div class="keys">
                <div class="key">I</div>
                <div class="key">I</div>
                <div class="key">I</div>
                <div class="key">J</div>
                <div class="key">K</div>
                <div class="key">L</div>
            </div>
        </div>

        <div class="control-group">
            <h3>Player 4 (Yellow)</h3>
            <div class="keys">
                <div class="key">8</div>
                <div class="key">8</div>
                <div class="key">8</div>
                <div class="key">4</div>
                <div class="key">5</div>
                <div class="key">6</div>
            </div>
        </div>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        <div class="game-over" id="gameOver">
            <h2>Game Over!</h2>
            <p id="winnerText"></p>
            <button onclick="startGame()">New Game</button>
        </div>
    </div>

    <div class="game-info">
        <div class="score">Score: <span id="totalScore">0</span></div>
        <div class="players">
            <div class="player player1">
                <div class="player-name">Player 1</div>
                <div class="player-score" id="score1">0</div>
            </div>
            <div class="player player2">
                <div class="player-name">Player 2</div>
                <div class="player-score" id="score2">0</div>
            </div>
            <div class="player player3">
                <div class="player-name">Player 3</div>
                <div class="player-score" id="score3">0</div>
            </div>
            <div class="player player4">
                <div class="player-name">Player 4</div>
                <div class="player-score" id="score4">0</div>
            </div>
        </div>
    </div>

    <div class="instructions">
        <p>Use WASD, Arrow Keys, IJKL, or Numpad to control your snake. Eat food to grow and avoid collisions!</p>
        <p>Press SPACE to start/pause the game</p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const GRID_SIZE = 20;
        const CANVAS_WIDTH = canvas.width;
        const CANVAS_HEIGHT = canvas.height;
        const GRID_WIDTH = CANVAS_WIDTH / GRID_SIZE;
        const GRID_HEIGHT = CANVAS_HEIGHT / GRID_SIZE;

        // Game state
        let gameRunning = false;
        let gamePaused = false;
        let gameSpeed = 150;
        let gameLoop;

        // Players
        const players = [
            {
                id: 1,
                name: 'Player 1',
                color: '#00ff88',
                keys: { up: 'KeyW', down: 'KeyS', left: 'KeyA', right: 'KeyD' },
                snake: [{ x: 5, y: 5 }],
                direction: { x: 1, y: 0 },
                nextDirection: { x: 1, y: 0 },
                score: 0,
                alive: true
            },
            {
                id: 2,
                name: 'Player 2',
                color: '#ff4444',
                keys: { up: 'ArrowUp', down: 'ArrowDown', left: 'ArrowLeft', right: 'ArrowRight' },
                snake: [{ x: 25, y: 5 }],
                direction: { x: -1, y: 0 },
                nextDirection: { x: -1, y: 0 },
                score: 0,
                alive: true
            },
            {
                id: 3,
                name: 'Player 3',
                color: '#4444ff',
                keys: { up: 'KeyI', down: 'KeyK', left: 'KeyJ', right: 'KeyL' },
                snake: [{ x: 5, y: 15 }],
                direction: { x: 1, y: 0 },
                nextDirection: { x: 1, y: 0 },
                score: 0,
                alive: true
            },
            {
                id: 4,
                name: 'Player 4',
                color: '#ffff44',
                keys: { up: 'Numpad8', down: 'Numpad5', left: 'Numpad4', right: 'Numpad6' },
                snake: [{ x: 25, y: 15 }],
                direction: { x: -1, y: 0 },
                nextDirection: { x: -1, y: 0 },
                score: 0,
                alive: true
            }
        ];

        // Food
        let food = { x: 15, y: 10 };

        // Initialize game
        function initGame() {
            players.forEach(player => {
                player.snake = [{ x: Math.floor(Math.random() * GRID_WIDTH), y: Math.floor(Math.random() * GRID_HEIGHT) }];
                player.direction = { x: 1, y: 0 };
                player.nextDirection = { x: 1, y: 0 };
                player.score = 0;
                player.alive = true;
            });
            generateFood();
            updateScore();
        }

        function generateFood() {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * GRID_WIDTH),
                    y: Math.floor(Math.random() * GRID_HEIGHT)
                };
            } while (isFoodOnSnake(newFood));
            food = newFood;
        }

        function isFoodOnSnake(foodPos) {
            return players.some(player => 
                player.snake.some(segment => 
                    segment.x === foodPos.x && segment.y === foodPos.y
                )
            );
        }

        function updateScore() {
            const totalScore = players.reduce((sum, player) => sum + player.score, 0);
            document.getElementById('totalScore').textContent = totalScore;
            
            players.forEach(player => {
                document.getElementById(`score${player.id}`).textContent = player.score;
            });
        }

        function moveSnake(player) {
            if (!player.alive) return;

            // Update direction
            player.direction = { ...player.nextDirection };

            // Move head
            const head = { ...player.snake[0] };
            head.x += player.direction.x;
            head.y += player.direction.y;

            // Check wall collision
            if (head.x < 0 || head.x >= GRID_WIDTH || head.y < 0 || head.y >= GRID_HEIGHT) {
                player.alive = false;
                return;
            }

            // Check self collision
            if (player.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                player.alive = false;
                return;
            }

            // Check collision with other snakes
            for (let otherPlayer of players) {
                if (otherPlayer.id !== player.id && otherPlayer.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    player.alive = false;
                    return;
                }
            }

            player.snake.unshift(head);

            // Check food collision
            if (head.x === food.x && head.y === food.y) {
                player.score += 10;
                generateFood();
            } else {
                player.snake.pop();
            }
        }

        function draw() {
            // Clear canvas
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Draw grid
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 1;
            for (let x = 0; x <= CANVAS_WIDTH; x += GRID_SIZE) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, CANVAS_HEIGHT);
                ctx.stroke();
            }
            for (let y = 0; y <= CANVAS_HEIGHT; y += GRID_SIZE) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(CANVAS_WIDTH, y);
                ctx.stroke();
            }

            // Draw food
            ctx.fillStyle = '#ffff00';
            ctx.fillRect(food.x * GRID_SIZE + 2, food.y * GRID_SIZE + 2, GRID_SIZE - 4, GRID_SIZE - 4);

            // Draw snakes
            players.forEach(player => {
                if (!player.alive) return;

                ctx.fillStyle = player.color;
                player.snake.forEach((segment, index) => {
                    const alpha = index === 0 ? 1 : 0.7; // Head is brighter
                    ctx.globalAlpha = alpha;
                    ctx.fillRect(
                        segment.x * GRID_SIZE + 1,
                        segment.y * GRID_SIZE + 1,
                        GRID_SIZE - 2,
                        GRID_SIZE - 2
                    );
                });
                ctx.globalAlpha = 1;
            });
        }

        function gameUpdate() {
            if (!gameRunning || gamePaused) return;

            // Move all alive players
            players.forEach(player => moveSnake(player));

            // Check if game should end
            const alivePlayers = players.filter(player => player.alive);
            if (alivePlayers.length <= 1) {
                endGame();
                return;
            }

            updateScore();
            draw();
        }

        function endGame() {
            gameRunning = false;
            clearInterval(gameLoop);

            const alivePlayers = players.filter(player => player.alive);
            const winnerText = document.getElementById('winnerText');
            
            if (alivePlayers.length === 1) {
                winnerText.textContent = `${alivePlayers[0].name} wins with ${alivePlayers[0].score} points!`;
            } else {
                winnerText.textContent = 'No one survived!';
            }

            document.getElementById('gameOver').style.display = 'block';
        }

        function startGame() {
            initGame();
            gameRunning = true;
            gamePaused = false;
            document.getElementById('gameOver').style.display = 'none';
            
            gameLoop = setInterval(gameUpdate, gameSpeed);
            draw();
        }

        function togglePause() {
            if (!gameRunning) return;
            
            gamePaused = !gamePaused;
            if (gamePaused) {
                clearInterval(gameLoop);
            } else {
                gameLoop = setInterval(gameUpdate, gameSpeed);
            }
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!gameRunning) {
                    startGame();
                } else {
                    togglePause();
                }
                return;
            }

            // Find player by key
            const player = players.find(p => 
                Object.values(p.keys).includes(e.code)
            );

            if (!player || !player.alive) return;

            // Update direction based on key
            if (e.code === player.keys.up && player.direction.y !== 1) {
                player.nextDirection = { x: 0, y: -1 };
            } else if (e.code === player.keys.down && player.direction.y !== -1) {
                player.nextDirection = { x: 0, y: 1 };
            } else if (e.code === player.keys.left && player.direction.x !== 1) {
                player.nextDirection = { x: -1, y: 0 };
            } else if (e.code === player.keys.right && player.direction.x !== -1) {
                player.nextDirection = { x: 1, y: 0 };
            }

            // Visual feedback for key press
            const keyElement = document.querySelector(`.control-group:nth-child(${player.id}) .key`);
            if (keyElement) {
                keyElement.classList.add('active');
                setTimeout(() => keyElement.classList.remove('active'), 100);
            }
        });

        // Initialize
        initGame();
        draw();
    </script>
</body>
</html>
